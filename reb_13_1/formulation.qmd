---
format:
  html:
    toc: false
    embed-resources: true
---

```{r}
#| echo: false
#| output: false
library(tidyverse)
library(knitr)
library(kableExtra)
source('~/Libraries/R/fmt_tibble_col.R')
```

### Example 13-1

{{< include problem_statement.qmd >}}

```{r}
#| echo: false
#| output: false
path_to_data <- './Data/'
path_to_results <- './Results/'
path_to_figures <- './Results/'
```

---

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

This assignment describes a single BSTR and its operation. There is no other equipment. The reaction taking place in the reactor is identified, and a rate expression is provided for it. The quantities of interest in the assignment are reactor variables. I know from @sec-5_response_opt_design that this combination of characteristics identifies this as an isolated reactor modeling assignment.

I know the general approach to completing an isolated reactor modeling assignment that was described in @sec-5_response_opt_design. There are five basic steps.

1. Summarize the information provided in the assignment.
2. Formulate the solution mathematically.
3. Implement the solution numerically.
4. Execute the solution.
5. Report and comment upon the results.

To summarize the information provided in the assignment I'll read through the problem and extract the following information:

1. Summarize the information provided in the assignment.
	a. Reactor type and operational mode
	b. Constant quantities
	c. Adjusted quantities
	d. Missing reactor input or process parameter and specified reactor response
	e. Quantities of interest

:::

**Information Provided in the Assignment**

**Reactor**: adiabatic BSTR

**Given Constants**: $\Delta H_1$ = -101.2 kJ mol^-1^, $k_{0,1}$ = 5.11 x 10^4^ L mol^-1^ s^-1^, $E_1$ = 74.8 kJ mol^-1^, $V$ = 1900 L}, $T_0$ = (180 + 273.15) K, $C_{A,0}$ = 2.9 mol L^-1^, $C_{B,0}$ = 3.2 mol L^-1^, $\tilde{C}_p$ = 1.23 cal g^-1^ K^-1^, $\rho$ = 1.02 g cm^-3^, and $t_{max}$ = 2 h.

**Adjusted Quantity**: $t$

**Quantities of Interest**: $C_A\left(t\right)$, $C_B\left(t\right)$, $C_Y\left(t\right)$, $C_Z\left(t\right)$, $T\left(t\right)$, and $r\left(t\right)$ where $0 \lt t \lt t_{max}$.

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

The second basic step for completing an isolated BSTR modeling assignment is to formulate the solution mathematically. From my reading of this chapter, I know, generally, how to do this.

2. Formulate the solution mathematically.
	a. Choose, write and simplify the reactor design equations needed to model the reactor.
	b. Identify the independent variable and the dependent variables, and ensure that the number of dependent variables is equal to the number of reactor design equations.
	c. Specify the initial values and the stopping criterion, and write equations for calculating their values.
	d. Write equations to express every quantity appearing in the reactor design equations or in equations that will be substituted into the reactor design equations in terms of known constants, the independent variable, the dependent variables, the missing reactor input or process parameter (if there is one), and the adjusted quantities (if there are any).
	e. Write the equations to calculate every quantity of interest and the response that was specified in the assignment (if there is one) using the results from solving the reactor design equations, the independent variable, the dependent variables, the missing reactor input or process parameter (if there is one), and the adjusted quantities (if there are any).
	f. Briefly explain or outline the sequence of calculations that must be used to calculate and process the quantities of interest (and the response that was specified in the assignment, if there is one).

:::

**Mathematical Formulation of the Solution**

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

Mole balances are always included in the reactor design equations. Here I will write a mole balance for each of the four reagents starting from @eq-bstr_mole_balance. There is only one reaction taking place, so the summation reduces to a single term. The stoichiometric coefficients of A and B are each equal to -1, and the stoichiometric coefficients of Y and Z are each equal to +1.

$$
\frac{dn_i}{dt} = V \cancelto{\nu_i r}{\sum_j \nu_{i,j}r_j}
$$

$$
\frac{dn_i}{dt} = V \nu_i r
$$

The BSTR in this assignment is not isothermal; it is adiabatic. Therefore an energy balance must also be included among the design equations. The general form of the BSTR energy balance is given in @eq-bstr_energy_balance. The reacting fluid is a liquid which I will assume to be an incompressible ideal solution. Consequently, the reacting fluid volume and the total pressure are constant, and their time derivatives are equal to zero. The reactor is adiabatic, so the rate of heat input, $\dot{Q}$, is equal to zero. There are no shafts or moving boundaries other than the agitator, and the rate at which it performs work is negligible, so $\dot{W}$ is also equal to zero. With only one reaction taking place, the summation over the reactions, $j$, reduces to a single term. Finally, this assignment provides the mass-specific heat capacity of the entire solution, so the sensible heat term can be re-written using that heat capacity, @eq-bstr_equivalent_sens_heat_terms.

$$
\cancelto{\rho V \tilde{C}_p}{\left(\sum_i n_i \hat C_{p,i} \right)} \frac{dT}{dt} - \cancelto{0}{V\frac{dP}{dt}}  - \cancelto{0}{P\frac{dV}{dt}}  = \cancelto{0}{\dot Q} - \cancelto{0}{\dot W} - V \cancelto{r \Delta H}{\sum_j \left(r_j \Delta H_j \right)}
$$

$$
\rho V \tilde{C}_p \frac{dT}{dt} = - V r \Delta H
$$

The BSTR here operates adiabatically, so there isn't an exchange fluid for which to write an energy balance, and momentum balances are not used with BSTRs, so that completes the reactor design equations needed to model the BSTR in this assignment.

:::

**Reactor Design Equations**

Mole balance design equations for A, B, Y, and Z are presented in equations (3) through (6), and the energy balance on the reacting fluid is given by equation (7).

$$
\frac{dn_A}{dt} = -rV \tag{3}
$$

$$
\frac{dn_B}{dt} = -rV \tag{4}
$$

$$
\frac{dn_Y}{dt} = rV \tag{5}
$$

$$
\frac{dn_Z}{dt} = rV \tag{6}
$$

$$
\frac{dT}{dt} = \frac{-r \Delta H_1}{\rho \tilde{C}_p} \tag{7}
$$

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

The reactor design equations are a set of five IVODEs. The independent variable is $t$ and the dependent variables are $n_A$, $n_B$, $n_Y$, $n_Z$, and $T$. There are five IVODEs and five dependent variables, so no other IVODEs are needed. Initial values and a stopping criterion are needed in order to solve IVODEs.

The instant the fluids are mixed in the reactor can be defined as $t=0$. The fluids that are charged to the reactor do not contain Y or Z, so their initial molar amounts are zero. The initial molar amounts of A and B, $n_{A,0}$ and $n_{B,0}$, are not given, but they can be calculated from their initial concentrations and the reactor volume, which are given. The initial temperature, $T_0$ is given.

The assignment asks for the reagent concentrations, temperature, and rate over the first 2 h of operation, so $t_{max}$ can be used to represent the stopping criterion and be set equal to 2 h.

:::

**Initial Values and Stopping Criterion**

The initial values and stopping criterion needed for solving the design equations are given in @tbl-example_13_1_initial_values. The initial molar amounts of A and B shown in the table can be calculated using equations (8) and (9).

| Variable | Initial Value | Stopping Criterion |
|:------:|:-------:|:-------:|
| $t$ | $0$ | $t_{max}$ |
| $n_A$ | $n_{A,0}$ | |
| $n_B$ | $n_{B,0}$ | |
| $n_Y$ | $0$ | |
| $n_Z$ | $0$ | |
| $T$ | $T_0$ | |
  
: Initial values and stopping criterion for solving the design equations, equations (3) through (7). {#tbl-example_13_1_initial_values}

$$
n_{A,0} = C_{A,0}V \tag{8}
$$

$$
n_{B,0} = C_{B,0}V \tag{9}
$$

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

The design equations cannot be solved until every quantity appearing in them and every quantity substituted into them is expressed in terms of known constants, the independent variable and the dependent variables. The only quantity appearing in equations (3) through (7) that isn't a known constant, the independent variable or a dependent variable is the rate, $r$. Equation (2) can be used to eliminate $r$ from the design equations, but that introduces $k$, $C_A$, and $C_B$. The rate coefficient can be expressed in terms of $T$ and known constants using the Arrhenius expression, @eq-arrhenius. The concentrations of A and B can be expressed in terms of $n_A$, $n_B$, and known constants using the defining equation for concentration.

Having gone through the equations I can see that the values of all of the reactor inputs and process parameters are known. There aren't any missing values.

:::

**Ancillary Equations for Solving the Reactor Design Equations**

$$
k = k_{0,1}\exp{\left( \frac{-E_1}{RT} \right)} \tag{10}
$$

$$
C_A = \frac{n_A}{V} \tag{11}
$$

$$
C_B = \frac{n_B}{V} \tag{12}
$$

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

With the information provided above, the design equations can be solved to find $n_A\left(t\right)$, $n_B\left(t\right)$, $n_Y\left(t\right)$, $n_Z\left(t\right)$, and $T\left(t\right)$ for $0 \le t \le t_{max}$. The quantities of interest in the assignment are the concentrations of the reagents, the temperature, and the instantaneous reaction rate. The concentrations can again be calculated using the defining equation for concentration, and the rate can be calculated using equations (2), (10), (11), and (12).

:::

**Ancillary Equations for Calculating the Quantities of Interest**

Solving equations (3) through (7) will yield $n_A\left(t\right)$, $n_B\left(t\right)$, $n_Y\left(t\right)$, $n_Z\left(t\right)$, and $T\left(t\right)$ for $0 \le t \le t_{max}$. The concentrations of A, B, Y, and Z at those times can be computed using equations (11) through (14). The instantaneous reaction rate at those times can be found by calculating $k$ using equation (10), and using the result along with the concentrations of A and B in equation (2).

$$
C_Y = \frac{n_Y}{V} \tag{13}
$$

$$
C_Z = \frac{n_B}{V} \tag{14}
$$

**Sequence of Calculations to Complete the Assignment**

1. Substitute given and known constants into all equations.
2. Substitute equations (10), (11), and (12) into equation (2).
3. Substitute equation (2) into equations (3) through (7).
4. Calculate $n_{A,0}$ and $n_{B,0}$ using equations (8) and (9).
5. Solve equations (3) through (7) using the initial values and stopping criterion in @tbl-example_13_1_initial_values to get $n_A\left(t\right)$, $n_B\left(t\right)$, $n_Y\left(t\right)$, $n_Z\left(t\right)$, and $T\left(t\right)$.
6. Calculate $C_A\left(t\right)$, $C_B\left(t\right)$, $C_Y\left(t\right)$, and $C_Z\left(t\right)$ using equations (11) through (14).
7. Calculate $r\left(t\right)$ by substituting equation (10), $C_A\left(t\right)$, and $C_B\left(t\right)$ into equation (2).
8. Plot $C_A\left(t\right)$, $C_B\left(t\right)$, $C_Y\left(t\right)$, $C_Z\left(t\right)$, $T\left(t\right)$, and $r\left(t\right)$ *vs*. $t$.

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

Having formulated the solution mathematically, the third basic step for completing an isolated reactor modeling assignment is to implement the solution numerically. I know that this will entail creating two computer functions.

3. Implement the solution numerically.
	a. Create a response function.
		i. Pass the missing value (if there is one) and the adjusted values (if there are any) to it as arguments.
		ii. Solve the reactor design equations for each set of adjusted values.
		iii. Calculate and return the quantities of interest (and the specified response if there is one) corresponding to each set of adjusted values.
	b. Create a calculations function.
		i. Perform the sequence of calculations that is needed to calculate the quantities of interest, calling or using the response function as needed.
		ii. Process the quantities of interest as necessary to complete the assignment.

:::

**Numerical Implementation of the Solution**

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

I know that the purpose of the response function is to calculate the quantities of interest. In this assignment there isn't a missing reactor input or process parameters. That means that the response function will not have a missing value argument.

There is an adjusted value, namely $t$. However, in this assignment I do not need to pass a range of values of $t$ to the response function because the IVODE solver will generate a range of values between $t = 0$ and $t=t_{rxn}$ as it solves the IVODEs.

When IVODEs are solved numerically, analytic expressions for the dependent variables as functions of the dependent variables (e. g. $n_A\left(t\right)$) are not obtained. Instead the solution takes the form of a vector containing values of the independent variable and vectors containing corresponding values of the dependent variables. Hence, the response function must complete the first seven steps in the sequence given above and then return a vector containing the range of values of $t$ and vectors containing the correponding values of $C_A$, $C_B$, $C_Y$, $C_Z$, $T$, and $r$.

:::

**Response Function**

The response function is created with the following structure:

* It does not receive any arguments.
* Variables are defined and assigned the values of all known and given quantities.
* The initial values and stopping criterion are set according to @tbl-example_13_1_initial_values and equations (8) and (9).
* In preparation for solving the IVODEs, it defines a function to evaluate $\frac{dn_A}{dt}$, $\frac{dn_B}{dt}$, $\frac{dn_Y}{dt}$, $\frac{dn_Z}{dt}$, and $\frac{dT}{dt}$ using equations (3) through (7). That function
	* Receives values for $t$, $n_A$, $n_B$, $n_Y$, $n_Z$, and $T$,
	* Calculates calcuate $k$, $C_A$, and $C_B$ using equations (10) through (12),
	* Calculates $r$ using equation (2), and
	* Calculates and returns the values $\frac{dn_A}{dt}$, $\frac{dn_B}{dt}$, $\frac{dn_Y}{dt}$, $\frac{dn_Z}{dt}$, and $\frac{dT}{dt}$ using equations (3) through (7).
* The response function then calls an IVODE solver, passing that function and the initial values and stopping criterion to it. 
    * The IVODE solver returns a vector containing a range of values of $t$ and vectors containing the correponding values of $n_A$, $n_B$, $n_Y$, $n_Z$, and $T$.
* The returned values are used to calculate vectors containing the corresponding values of $C_A$, $C_B$, $C_Y$, and $C_Z$.
* The vectors containing $T$, $C_A$, and $C_B$ are used to calculate a vector containing the corresponding values of $r$ using equations (10) and (2).
* The response function returns a vector containing the range of values of $t$ and vectors containing the correponding values of $C_A$, $C_B$, $C_Y$, $C_Z$, $T$, and $r$

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

The calculations function is responsible for performing the entire sequence of calculations listed at the end of the mathematical formulation. It can accomplish the first seven steps by simply calling the response function. After that all it needs to do is generate the graphs that are requested in the assignment.

:::

**Calculations Function**

The calculations function is created with the following structure:

* It does not receive any arguments.
* It calls the response function.
    * The response function returns a vector containing the range of values of $t$ and vectors containing the correponding values of $C_A$, $C_B$, $C_Y$, $C_Z$, $T$, and $r$
* It generates and displays graphs by plotting $C_A$, $C_B$, $C_Y$, $C_Z$, $T$, and $r$ *vs*. $t$.
* It saves the results to one or more files.

**Performing the Calculations**

After creating the response function and calculations function as described, all of the calculations needed to complete the assignment can be performed by executing the calculations function.

**Results**

The variation of concentrations of reagents, A, B, Y, and Z, during the first two hours of operation of the BSTR are shown in  @fig-example_13_1_concentrations. The variation of the reacting fluid temperature during that period is shown in @fig-example_13_1_temperatures, and the variation of the instantaneous rate is shown in @fig-example_13_1_rates.

![Concentrations *versus* reaction time.](`r paste0(path_to_figures,'reb_13_1_C_vs_t.png')`){#fig-example_13_1_concentrations width="60%"}

![Temperature *versus* reaction time.](`r paste0(path_to_figures,'reb_13_1_T_vs_t.png')`){#fig-example_13_1_temperatures width="60%"}

![Rate *versus* reaction time.](`r paste0(path_to_figures,'reb_13_1_r_vs_t.png')`){#fig-example_13_1_rates width="60%"}

**Summary**

The concentrations of the reactants, A and B, decrease monotonically during the first two hours of operation while the concentrations of the products, Y and Z, increase. The temperature increases steadily, too. The variation of the reaction rate is different. Initially it increases, but then it passes through a maximum after which it steadily decreases.

**Qualitative Analysis**

A qualitative analysis shows that the variations in the concentrations, temperature and rate seen in Figures [-@fig-example_13_1_concentrations], [-@fig-example_13_1_temperatures], and [-@fig-example_13_1_rates] are expected. At $t=0$, the concentrations of the reagents and the temperature are all at their initial values. At this point the rate has the corresponding value calculated using equations (8), (9), (10), and (2).

**After a short interval** of time, since the rate is positive, the concentrations of A and B will have decreased slightly and the concentration of Y and Z will have increased slightly due to the occurrence of the reaction. Because the reaction is exothermic and the reactor operates adiabatically, the temperature will have increased due to the heat released by the reaction. The rate could either increase or decrease during this short interval. The concentrations of the reactants, A and B, are decreasing, and this alone would cause the rate to decrease. However, at the same time the temperature is increasing, and that alone would cause the rate to increase. Generally the exponential dependence of the rate upon the temperature will be stronger than its dependence upon the reactant concentrations, and the rate will increase. This is seen to be the case in @fig-example_13_1_rates. (Had the heat of reaction been very small, leading to a small increase in the temperature, it is possible that the rate would have decreased, especially if the activation was also small).

*During that initial short interval of time, the concentrations of Y and Z, the temperature, and the rate all have positive slopes while the concentrations of A and B have negative slopes*. **During the next short interval of time**, the rate is larger than during the first interval of time. As a consequence, *the concentrations and temperature will change more during the second interval*. Thus, *the curvature of temperature, Y concentration, and Z concentration profiles is initially concave upward and the curvature of the A and B concentration profiles is initially concave downward*. Again during this interval, opposing effects are associated with the decreasing reactant concentrations and the increasing temperature.

The initial curvature of the concentration and temperature profiles is very slight and can't really be discerned in @fig-example_13_1_concentrations and @fig-example_13_1_temperatures. Nonetheless, **the initial curvature must change at some later time**. Initially the concentrations of A and B are decreasing faster and faster and the concentrations of Y and Z and the temperature are increasing faster and faster. These trends cannot continue indefinitely, if they did, $C_Y$, $C_Z$, and $T$ would approach positive infinity and $C_A$ and $C_B$ would approach negative infinity.

In fact, the curvature does change because **at some point the effect of decreasing reactant concentrations upon the rate becomes stronger than the effect of increasing temperature**. At the point where the two effects become equal, the rate reaches a maximum. Beyond the maximum, the effect of decreasing reactant concentration dominates and the rate decreases. This is seen in @fig-example_13_1_rates where the instantaneous rate passes through a maximum.

At the point where the rate reaches its maximum value, the concentration and temperature profiles exhibit an inflection point. (Again, in this example this is very, very subtle and cannot be discerned in the figures.) Beyond that point, the $C_Y$, $C_Z$, and $T$ profiles are concave downward and the $C_A$ and $C_B$ are concave upward. That is, the changes over time become smaller and smaller. This behavior can continue indefinitely. Eventually the concentrations and temperature will stop changing and become constant. In this example, A is the limiting reactant, and the reaction is irreversible, so the concentrations and temperature will become constant when $C_A$ becomes equal to zero.
